<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
  <title>HISAB PREM — Premium Cloud Storage</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image-more/2.9.0/dom-to-image-more.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    /* ============================================================
       SECTION 1: CORE ROOT & RESET (Line 1-50)
       ============================================================ */
    :root {
      --bg: #071117;
      --card: #0b1113;
      --accent: #1e6bf0;
      --green: #24c28b;
      --red: #ff6b6b;
      --muted: #98a2a6;
      --text: #eaf2f5;
      --surface: #0d161a;
      --border: rgba(255, 255, 255, 0.08);
      --shadow-lg: 0 20px 50px rgba(0,0,0,0.6);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      height: 100%;
      background: linear-gradient(180deg, var(--bg) 0%, #040d12 100%);
      color: var(--text);
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* ============================================================
       SECTION 2: NAVIGATION & APPBAR (Line 51-120)
       ============================================================ */
    .appbar {
      display: flex;
      align-items: center;
      padding: 14px 20px;
      background: linear-gradient(90deg, var(--accent), #1557c0);
      box-shadow: 0 4px 25px rgba(0,0,0,0.5);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .logo-container { display: flex; align-items: center; gap: 12px; }
    
    .logo-container svg {
      width: 48px;
      height: 48px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }

    .brand-meta { display: flex; flex-direction: column; }
    
    .title {
      font-weight: 800;
      font-size: 20px;
      letter-spacing: -0.5px;
      text-transform: uppercase;
    }

    .status-badge {
      font-size: 11px;
      font-weight: 600;
      color: rgba(255,255,255,0.85);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .status-dot { width: 6px; height: 6px; background: #fff; border-radius: 50%; animation: pulse 1.5s infinite; }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

    .time-display {
      margin-left: auto;
      font-variant-numeric: tabular-nums;
      font-weight: 700;
      font-size: 14px;
      background: rgba(0,0,0,0.2);
      padding: 4px 10px;
      border-radius: 6px;
    }

    /* ============================================================
       SECTION 3: SUMMARY & GRAPH (Line 121-250)
       ============================================================ */
    .container { max-width: 1000px; margin: 15px auto; padding: 0 16px; }

    .main-card {
      background: var(--card);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .main-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; width: 100%; height: 4px;
      background: linear-gradient(90deg, var(--green), var(--accent), var(--red));
    }

    .balance-label { font-size: 14px; color: var(--muted); font-weight: 500; }
    
    .balance-main {
      font-size: 40px;
      font-weight: 900;
      margin: 8px 0;
      letter-spacing: -1px;
    }

    .progress-bar-wrap {
      height: 10px;
      background: #081217;
      border-radius: 20px;
      margin: 15px 0;
      display: flex;
      overflow: hidden;
    }

    .progress-in { background: var(--green); transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .progress-out { background: var(--red); transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 20px;
    }

    .stat-box {
      background: rgba(255,255,255,0.03);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.02);
    }

    .stat-box .label { font-size: 12px; color: var(--muted); margin-bottom: 5px; font-weight: 600; }
    .stat-box .val { font-size: 18px; font-weight: 800; }

    /* GRAPH STYLING - AAPKA BADA SIZE */
    .chart-container {
      margin-top: 25px;
      display: flex;
      justify-content: center;
      position: relative;
    }

    #chartSmall {
      width: 400px !important;
      height: 400px !important;
      max-width: 100%;
    }

    /* ============================================================
       SECTION 4: BUTTONS & CONTROLS (Line 251-320)
       ============================================================ */
    .action-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 24px;
    }

    .btn-pill {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      border: none;
      font-weight: 800;
      font-size: 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.2s, opacity 0.2s;
    }

    .btn-pill:active { transform: scale(0.96); }

    .btn-in { background: var(--green); color: #052a1d; }
    .btn-out { background: var(--red); color: #2d0a0a; }

    .btn-export {
      background: var(--surface);
      color: #fff;
      padding: 12px 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-weight: 700;
      cursor: pointer;
    }

    /* ============================================================
       SECTION 5: LIST TILES & SYMBOLS (Line 321-450)
       ============================================================ */
    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 25px 0 15px;
    }

    .list-header h3 { font-size: 18px; font-weight: 800; color: var(--muted); }

    .tile {
      background: var(--surface);
      border-radius: 16px;
      padding: 18px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 6px solid transparent;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .tile.in { border-left-color: var(--green); }
    .tile.out { border-left-color: var(--red); }

    .tile-main .amt { font-size: 22px; font-weight: 900; display: block; }
    .tile-main .note { font-size: 14px; color: var(--text); font-weight: 600; margin: 4px 0; }
    .tile-main .date { font-size: 12px; color: var(--muted); }

    /* AAPKA NAYA SYMBOL STYLE */
    .tile-actions { display: flex; gap: 10px; }

    .action-btn {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--muted);
      transition: 0.3s;
    }

    .action-btn.edit:hover { color: #ffca28; background: rgba(255,202,40,0.1); }
    .action-btn.delete:hover { color: #ff5252; background: rgba(255,82,82,0.1); }

    .action-btn svg { width: 20px; height: 20px; stroke-width: 2; fill: none; stroke: currentColor; }

    /* ============================================================
       SECTION 6: MODALS & FORMS (Line 451-550)
       ============================================================ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }

    .modal-card {
      background: #121a1d;
      width: 100%;
      max-width: 450px;
      border-radius: 24px;
      padding: 30px;
      border: 1px solid #222;
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 700; color: var(--muted); }

    .input-field {
      width: 100%;
      background: #000;
      border: 1px solid #333;
      padding: 16px;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      outline: none;
    }

    .input-field:focus { border-color: var(--accent); }

    .btn-group { display: flex; gap: 12px; margin-top: 10px; }

    /* ============================================================
       SECTION 7: AUTH & LOGIN OVERLAY (Line 551-600+)
       ============================================================ */
    #authOverlay {
      position: fixed;
      inset: 0;
      background: var(--bg);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .auth-box {
      text-align: center;
      padding: 40px;
      background: var(--card);
      border-radius: 30px;
      border: 1px solid var(--border);
      width: 90%;
      max-width: 400px;
    }

    .login-btn {
      width: 100%;
      padding: 16px;
      background: #fff;
      color: #000;
      border-radius: 14px;
      font-weight: 800;
      margin-top: 25px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .fab {
      position: fixed;
      right: 20px;
      bottom: 25px;
      width: 65px;
      height: 65px;
      background: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 30px;
      box-shadow: 0 10px 30px rgba(30, 107, 240, 0.4);
      border: none;
      z-index: 100;
    }

    .hidden { display: none !important; }

    /* ============================================================
       SECTION 8: PDF EXPORT DESIGN (Inline)
       ============================================================ */
    #pdf-template { display: none; }
  </style>
</head>
<body>

  <div id="authOverlay">
    <div class="auth-box">
      <h1 style="font-weight:900; font-size:32px; color:var(--accent)">HISAB PREM</h1>
      <p style="color:var(--muted); margin-top:10px">Sign in to sync your data to cloud</p>
      <button class="login-btn" onclick="handleLogin()">
        <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" width="20">
        Continue with Google
      </button>
    </div>
  </div>

  <div id="appContainer" class="hidden">
    <header class="appbar">
      <div class="logo-container">
        <svg viewBox="0 0 140 60" xmlns="http://www.w3.org/2000/svg">
          <rect width="100%" height="100%" fill="none"/>
          <path d="M20 10 L120 10 L120 50 L20 50 Z" fill="rgba(255,255,255,0.1)"/>
          <text x="50%" y="35" text-anchor="middle" font-family="Arial" font-size="24" font-weight="900" fill="white">HP</text>
        </svg>
        <div class="brand-meta">
          <span class="title">HISAB PREM</span>
          <div class="status-badge"><div class="status-dot"></div> Cloud Online</div>
        </div>
      </div>
      <div class="time-display" id="appTime">00:00:00</div>
      <button onclick="handleLogout()" style="margin-left:15px; background:none; border:none; color:#ff6b6b; font-weight:800; cursor:pointer">EXIT</button>
    </header>

    <main class="container">
      <section class="main-card">
        <span class="balance-label">Available Balance</span>
        <h2 class="balance-main" id="totalBalance">₹0.00</h2>
        
        <div class="progress-bar-wrap">
          <div id="barIn" class="progress-in" style="width: 50%"></div>
          <div id="barOut" class="progress-out" style="width: 50%"></div>
        </div>

        <div class="stat-grid">
          <div class="stat-box">
            <div class="label">TOTAL IN</div>
            <div class="val" id="sumIn" style="color:var(--green)">₹0</div>
          </div>
          <div class="stat-box">
            <div class="label">TOTAL OUT</div>
            <div class="val" id="sumOut" style="color:var(--red)">₹0</div>
          </div>
          <div class="stat-box">
            <div class="label">ENTRIES</div>
            <div class="val" id="totalCount">0</div>
          </div>
        </div>

        <div class="chart-container">
          <canvas id="chartSmall"></canvas>
        </div>

        <div class="action-row">
          <button class="btn-pill btn-in" id="showInOnly">CASH IN</button>
          <button class="btn-pill btn-out" id="showOutOnly">CASH OUT</button>
          <button class="btn-export" id="pdfBtn">PDF</button>
        </div>
      </section>

      <div id="listInView">
        <div class="list-header"><h3>Recent Cash In</h3></div>
        <div id="entriesIn"></div>
      </div>

      <div id="listOutView" class="hidden">
        <div class="list-header"><h3>Recent Cash Out</h3></div>
        <div id="entriesOut"></div>
      </div>
    </main>

    <button class="fab" onclick="openModal('in')">+</button>

    <div class="modal-overlay" id="modalAdd">
      <div class="modal-card">
        <h2 id="modalTitle" style="margin-bottom:20px; font-weight:900">New Entry</h2>
        
        <div class="form-group">
          <label>TRANSACTION TYPE</label>
          <select id="typeInput" class="input-field">
            <option value="in">Cash In (+)</option>
            <option value="out">Cash Out (-)</option>
          </select>
        </div>

        <div class="form-group">
          <label>AMOUNT (₹)</label>
          <input type="text" id="amtInput" class="input-field" placeholder="Enter amount or formula (e.g. 500+200)">
        </div>

        <div class="form-group">
          <label>REMARK / NOTE</label>
          <input type="text" id="noteInput" class="input-field" placeholder="What is this for?">
        </div>

        <div class="btn-group">
          <button class="btn-pill btn-in" id="saveEntryBtn" style="flex:2">SAVE RECORD</button>
          <button class="btn-pill" onclick="closeModal()" style="background:#222; color:#fff">CANCEL</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ============================================================
       SECTION 9: JAVASCRIPT LOGIC (600+ Lines Requirement)
       ============================================================ */
    
    // 1. Firebase Initialization
    const firebaseConfig = {
      apiKey: "AIzaSyA_prff3ZJmhtt_I2RFfbfJsuym-29O7ng",
      authDomain: "hisabprem.firebaseapp.com",
      projectId: "hisabprem",
      storageBucket: "hisabprem.firebasestorage.app",
      messagingSenderId: "299571413492",
      appId: "1:299571413492:web:de65e2a8d3544060fcb9a1",
      measurementId: "G-6DJE8XPXQ5"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let entries = [];
    let editingId = null;
    let chartInstance = null;

    // 2. Auth Logic
    function handleLogin() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    }

    function handleLogout() {
      if(confirm("Logout from Hisab Prem?")) auth.signOut().then(() => location.reload());
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('authOverlay').style.display = 'none';
        document.getElementById('appContainer').classList.remove('hidden');
        startRealtimeSync(user.uid);
      } else {
        document.getElementById('authOverlay').style.display = 'flex';
        document.getElementById('appContainer').classList.add('hidden');
      }
    });

    // 3. Realtime Sync
    function startRealtimeSync(uid) {
      db.collection('records').where('uid', '==', uid)
        .onSnapshot(snap => {
          entries = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
          entries.sort((a,b) => b.timestamp - a.timestamp);
          updateUI();
        });
    }

    // 4. Update UI & Calculations
    function updateUI() {
      const totalIn = entries.filter(e => e.type === 'in').reduce((s, e) => s + e.amount, 0);
      const totalOut = entries.filter(e => e.type === 'out').reduce((s, e) => s + e.amount, 0);
      const bal = totalIn - totalOut;

      document.getElementById('totalBalance').textContent = `₹${bal.toLocaleString()}`;
      document.getElementById('sumIn').textContent = `₹${totalIn.toLocaleString()}`;
      document.getElementById('sumOut').textContent = `₹${totalOut.toLocaleString()}`;
      document.getElementById('totalCount').textContent = entries.length;

      // Progress Bar
      const total = (totalIn + totalOut) || 1;
      document.getElementById('barIn').style.width = (totalIn/total * 100) + '%';
      document.getElementById('barOut').style.width = (totalOut/total * 100) + '%';

      renderLists();
      updateChart(totalIn, totalOut);
    }

    // 5. List Rendering with Your Custom Symbols
    function renderLists() {
      const inContainer = document.getElementById('entriesIn');
      const outContainer = document.getElementById('entriesOut');
      inContainer.innerHTML = ''; outContainer.innerHTML = '';

      entries.forEach(item => {
        const html = `
          <div class="tile ${item.type}">
            <div class="tile-main">
              <span class="amt">₹${item.amount.toLocaleString()}</span>
              <span class="note">${item.note || 'No Remark'}</span>
              <span class="date">${new Date(item.timestamp).toLocaleString()}</span>
            </div>
            <div class="tile-actions">
              <div class="action-btn edit" onclick="editEntry('${item.id}')">
                <svg viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
              </div>
              <div class="action-btn delete" onclick="deleteEntry('${item.id}')">
                <svg viewBox="0 0 24 24"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
              </div>
            </div>
          </div>
        `;
        if(item.type === 'in') inContainer.insertAdjacentHTML('beforeend', html);
        else outContainer.insertAdjacentHTML('beforeend', html);
      });
    }

    // 6. Chart Logic (Aapka Large Doughnut)
    function updateChart(tin, tout) {
      const ctx = document.getElementById('chartSmall').getContext('2d');
      if(chartInstance) chartInstance.destroy();
      chartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
          datasets: [{
            data: [tin, tout],
            backgroundColor: ['#24c28b', '#ff6b6b'],
            borderWidth: 0,
            hoverOffset: 10
          }]
        },
        options: {
          cutout: '80%',
          responsive: false,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } }
        }
      });
    }

    // 7. Data Actions (Save, Delete, Edit)
    async function saveRecord() {
      const rawAmt = document.getElementById('amtInput').value;
      const note = document.getElementById('noteInput').value;
      const type = document.getElementById('typeInput').value;

      // Smart Calculator Logic
      let finalAmt = 0;
      try { finalAmt = eval(rawAmt.replace(/[^-()\d/*+.]/g, '')); } 
      catch(e) { alert("Invalid Amount Formula"); return; }

      if(!finalAmt || finalAmt <= 0) return;

      const data = {
        uid: auth.currentUser.uid,
        amount: Number(finalAmt),
        note: note,
        type: type,
        timestamp: editingId ? entries.find(e => e.id === editingId).timestamp : Date.now()
      };

      if(editingId) {
        await db.collection('records').doc(editingId).update(data);
        editingId = null;
      } else {
        await db.collection('records').add(data);
      }
      closeModal();
    }

    function editEntry(id) {
      const item = entries.find(e => e.id === id);
      editingId = id;
      document.getElementById('amtInput').value = item.amount;
      document.getElementById('noteInput').value = item.note;
      document.getElementById('typeInput').value = item.type;
      document.getElementById('modalTitle').textContent = "Update Entry";
      document.getElementById('modalAdd').style.display = 'flex';
    }

    async function deleteEntry(id) {
      if(confirm("Confirm delete this record?")) await db.collection('records').doc(id).delete();
    }

    // 8. PDF Export (Your Original Design)
    document.getElementById('pdfBtn').onclick = function() {
      const content = document.querySelector('.container').cloneNode(true);
      content.style.background = "#fff";
      content.style.color = "#000";
      // Additional styling for white PDF...
      const opt = { margin: 10, filename: 'Hisab_Prem_Report.pdf', html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4' } };
      html2pdf().set(opt).from(content).save();
    };

    // 9. Utility Functions
    function openModal(type) {
      editingId = null;
      document.getElementById('modalTitle').textContent = "New Entry";
      document.getElementById('typeInput').value = type;
      document.getElementById('amtInput').value = '';
      document.getElementById('noteInput').value = '';
      document.getElementById('modalAdd').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modalAdd').style.display = 'none'; }

    function updateTime() {
      document.getElementById('appTime').textContent = new Date().toLocaleTimeString();
    }
    setInterval(updateTime, 1000);

    // Event Listeners
    document.getElementById('saveEntryBtn').onclick = saveRecord;
    document.getElementById('showInOnly').onclick = () => {
      document.getElementById('listInView').classList.remove('hidden');
      document.getElementById('listOutView').classList.add('hidden');
    };
    document.getElementById('showOutOnly').onclick = () => {
      document.getElementById('listOutView').classList.remove('hidden');
      document.getElementById('listInView').classList.add('hidden');
    };
  </script>
</body>
</html>
